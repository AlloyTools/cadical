MAKEFLAGS=-j $(if $(CORES),$(CORES),1)
OBJ=$(shell ls *.cpp|sed -e '/main/d' -e 's,.cpp$$,.o,g')
SRC=$(shell ls *.cpp *.hpp|grep -v config.hpp)
COMPILE=@CXX@ @CXXFLAGS@
all: cadical libcadical.a
.cpp.o:
	$(COMPILE) -c $<

cadical: cadical.o makefile
	$(COMPILE) -o $@ cadical.o
cadical.o: cadical.cc config.h makefile
	$(COMPILE) -c cadical.cc
config.h: make-config-header.sh $(SRC) makefile
	./make-config-header.sh > $@

-include dependencies
libcadical.a: $(OBJ) makefile
	ar rc $@ $(OBJ)
	ranlib $@
config.hpp: make-config-header.sh $(SRC) makefile
	./make-config-header.sh > $@
dependencies: config.h $(SRC) makefile
	$(COMPILE) -MM $(SRC)|sed -e 's,:,: makefile,' >$@

clean:
	rm -f *.o cadical makefile config.h dependencies
	rm -f cnfs/*.log cnfs/*.err cnfs/*.proof cnfs/*.check
