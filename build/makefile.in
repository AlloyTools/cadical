.SUFFIXES: .cpp .o
MAKEFLAGS=-j $(if $(CORES),$(CORES),1)
OBJ=$(shell ls ../src/*.cpp|sed -e '/main/d' -e 's,../src/,,' -e 's,.cpp$$,.o,g')
SRC=$(shell ls ../src/*.cpp ../src/*.hpp)
COMPILE=@CXX@ @CXXFLAGS@
all: cadical libcadical.a
%.o: ../src/%.cpp
	$(COMPILE) -c $<
-include dependencies
cadical: main.o libcadical.a makefile
	$(COMPILE) -o $@ main.o -L. -lcadical
libcadical.a: $(OBJ) makefile
	rm -f $@
	ar rc $@ $(OBJ)
	ranlib $@
config.hpp: make-config-header.sh $(SRC) makefile
	./make-config-header.sh > $@
dependencies: config.hpp ../src/*.cpp makefile
	$(COMPILE) -MM ../src/*.cpp|sed -e 's,:,: makefile,' >$@
clean:
	rm -f *.o *.a cadical makefile config.hpp dependencies
	rm -f *.gcda *.gcno *.gcov gmon.out
